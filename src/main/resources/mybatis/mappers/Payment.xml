<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="itc.hoseo.sew.payment.PaymentRepository">
	<insert id="addOrder" parameterType="Payment">
		<selectKey order="BEFORE" keyProperty="orderNo" resultType="Payment">
			SELECT 
	           cast(to_char(sysdate,'YYYYMMDD') || nvl(to_char(max(substr(orderNo, 9))), '0000') as number) +1
	           as orderNo
	        FROM
	            orderList
            WHERE
            	 to_char(orderDate,'YYYYMMDD') = to_char(sysdate,'YYYYMMDD')            	 
		</selectKey>
		INSERT INTO orderList
		VALUES (#{orderNo}, #{prodNo}, #{totalAmount}, #{totalPrice}, #{totalDeli}, #{orderDate})	
	</insert>
	<insert id="addOrderOption" parameterType="BuyOption">
		INSERT INTO orderOption (orderNo, orderColor, orderSize, orderAmount)
		INTO VALUE(#{orderNo}, #{prodColor}, #{prodSize}, #{prodAmount})
	</insert>
</mapper>